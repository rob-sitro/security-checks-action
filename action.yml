name: 'CI Security Checks'
description: 'A list of common open-source software security checks run as a composite Github action'
inputs:
  container-scan-flag:
    description: 'Enable anchore container image scanning'
    default: false
  container-dockerfile:
    description: 'Location of your dockerfile'
    default: ""
  anchore-results-file:
    description: 'The Anchore results file name and path'
    default: "results.json"
  anchore-severity-threshold:
    description: 'The Ancshore severitiy threshold you want to include in your report'
    default: "medium"
  anchore-fail-build:
    description: 'Fail build if severity threshold vulnerabilities are found'
    default: false
  sast-scan-flag:
    description: 'Enable Semgrep SAST scanning'
    default: true
  semgrep-app-token:
    description: 'You semgrep APP token taken from Semgrep App > Settings'
    default: ""
  semgrep-timeout:
    description: 'Scan timeout in seconds'
    default: 300
runs:
  using: "composite"
  steps:
    - name: Semgrep SAST Scan
      run: |
        docker run --rm -v "${PWD}:/src" -e SEMGREP_APP_TOKEN=${{ github.event.inputs.semgrep-app-token }} -e SEMGREP_TIMEOUT=${{ github.event.inputs.semgrep-timeout }} returntocorp/semgrep semgrep --config=auto
        
      shell: bash
